<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dashboard | DMS</title>
	<script src="https://unpkg.com/@tailwindcss/browser@4"></script>
	<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.4/html5-qrcode.min.js"></script>
	<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
	<style>
		::-webkit-scrollbar {
			width: 8px;
		}

		::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		::-webkit-scrollbar-thumb {
			background: #888;
		}

		::-webkit-scrollbar-thumb:hover {
			background: #555;
		}

		input.gridjs-input {
			/* box-shadow: 0 0 0 1px #141414; */
		}

		input.gridjs-input:focus {
			border-color: #615FFF;
			box-shadow: 0 0 0 3px #615FFF80;
		}

		.gridjs-search-input {
			width: 100%;
		}

		.attendance-table {
			width: 100%;
			border-collapse: collapse;
		}
		.attendance-table th {
			background-color: #615FFF;
			color: white;
			padding: 10px;
			text-align: left;
			font-size: 16px;
			text-align: center;
		}
		.attendance-table td {
			padding: 8px 10px;
			border-bottom: 1px solid #ddd;
			font-size: 14px;
			text-align: center;
		}
		.attendance-table tr:nth-child(even) {
			background-color: #f9f9f9;
		}
	</style>
</head>

<body>
	<section class="flex min-h-screen h-full bg-indigo-50">
		<div
			class="fixed top-0 left-0 flex flex-col bg-clip-border bg-[#141414] text-white min-h-screen h-screen min-w-[18rem] w-full max-w-[18rem] p-4 shadow-xl shadow-blue-gray-900/5 z-10">
			<div class="mb-2 p-4">
				<!-- <h5
					class="block antialiased tracking-normal font-sans text-xl font-semibold leading-snug text-white">
					DMS</h5> -->
				<img src="/static/images/IDEA-LOGO.png" class="w-[110px] h-[70px] object-contain" alt="logo">
			</div>
			<nav class="flex flex-col justify-between p-2 font-sans text-base font-normal text-white h-full">
				<div class="flex flex-col gap-1">
					<a href="/student/">
						<div role="button" tabindex="0"
							class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
							<div class="grid place-items-center mr-4">
								<svg fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
									<rect x="2" y="2" width="9" height="11" rx="2"></rect>
									<rect x="13" y="2" width="9" height="7" rx="2"></rect>
									<rect x="2" y="15" width="9" height="7" rx="2"></rect>
									<rect x="13" y="11" width="9" height="11" rx="2"></rect>
								</svg>
							</div>
							Dashboard
						</div>
					</a>
					<a href="/student/manage-complain/">
						<div role="button" tabindex="0"
							class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
							<div class="grid place-items-center mr-4">
								<svg fill="currentColor" class="w-5 h-5" viewBox="0 0 32 32">
									<defs id="defs2" />
									<g id="layer1" transform="translate(-108,-388)">
										<path
											d="m 115,408.01367 c -2.7527,0 -5,2.2473 -5,5 0,2.7527 2.2473,5 5,5 h 14 c 2.7527,0 5,-2.2473 5,-5 0,-2.7527 -2.2473,-5 -5,-5 z m 0,2 h 14 c 1.6793,0 3,1.32071 3,3 0,1.6793 -1.3207,3 -3,3 h -14 c -1.6793,0 -3,-1.3207 -3,-3 0,-1.67929 1.3207,-3 3,-3 z" />
										<path
											d="m 131,399.01367 a 1,1 0 0 0 -1,1 1,1 0 0 0 1,1 1,1 0 0 0 1,-1 1,1 0 0 0 -1,-1 z" />
										<path
											d="m 131,393.01367 a 1,1 0 0 0 -1,1 v 3 a 1,1 0 0 0 1,1 1,1 0 0 0 1,-1 v -3 a 1,1 0 0 0 -1,-1 z" />
										<path
											d="m 131,390.01367 c -2.63036,0 -4.9293,1.46542 -6.125,3.6211 -0.90021,-0.4054 -1.87895,-0.62123 -2.875,-0.6211 -3.85415,0 -7,3.14586 -7,7 0,3.85415 3.14585,7 7,7 a 1.000105,1.000105 0 0 0 0.002,0 c 2.57139,-0.007 4.90293,-1.42397 6.11524,-3.625 0.88031,0.40064 1.85579,0.625 2.88281,0.625 3.85414,0 7,-3.14585 7,-7 0,-3.85413 -3.14586,-7 -7,-7 z m 0,2 c 2.77327,0 5,2.22674 5,5 0,2.77327 -2.22673,5 -5,5 -0.98421,0 -1.89849,-0.28178 -2.66992,-0.76758 a 1.000005,1.000005 0 0 0 -0.2461,-0.16601 C 126.82049,400.17503 126,398.69579 126,397.01367 c 0,-0.5237 0.081,-1.02855 0.22852,-1.50195 a 1.000005,1.000005 0 0 0 0.10546,-0.30078 c 0.71945,-1.87506 2.52941,-3.19727 4.66602,-3.19727 z m -9,3 c 0.75319,-10e-5 1.49281,0.17045 2.16602,0.49414 -0.10719,0.48532 -0.16602,0.98922 -0.16602,1.50586 0,2.1085 0.94381,4.00364 2.42773,5.28906 -0.84495,1.64398 -2.53896,2.70503 -4.42773,2.71094 -2.77326,0 -5,-2.22673 -5,-5 0,-2.77326 2.22674,-5 5,-5 z" />
									</g>
								</svg>
							</div>
							Complains
						</div>
					</a>
					<a href="/student/manage-course/">
						<div role="button" tabindex="0"
							class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
							<div class="grid place-items-center mr-4">
								<svg fill="currentColor" class="w-5 h-5" viewBox="0 0 1920 1920">
									<path d="M1750.21 0v1468.235h-225.882v338.824h169.412V1920H451.387c-82.447 0-161.506-36.141-214.701-99.388-43.934-51.953-67.652-116.33-67.652-182.965V282.353C169.034 126.494 295.528 0 451.387 0H1750.21Zm-338.823 1468.235H463.81c-89.223 0-166.136 59.86-179.576 140.047-1.242 9.036-2.259 18.07-2.259 27.106v2.26c0 40.658 13.553 77.928 40.659 109.552 32.753 38.4 79.059 59.859 128.753 59.859h960v-112.941H409.599v-112.942h1001.788v-112.94Zm225.882-1355.294H451.387c-92.725 0-169.412 75.67-169.412 169.412v1132.8c50.824-37.27 113.958-59.859 181.835-59.859h1173.46V112.941ZM1354.882 903.53v112.942H564.294V903.529h790.588Zm56.47-564.705v451.764H507.825V338.824h903.529Zm-112.94 112.94H620.765v225.883h677.647V451.765Z"
										fill-rule="evenodd" />
								</svg>
							</div>
							Course
						</div>
					</a>
					<a href="/student/manage-attendance/">
						<div role="button" tabindex="0" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
							<div class="grid place-items-center mr-4">
								<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none">
									<path d="M18 7.16C17.94 7.15 17.87 7.15 17.81 7.16C16.43 7.11 15.33 5.98 15.33 4.58C15.33 3.15 16.48 2 17.91 2C19.34 2 20.49 3.16 20.49 4.58C20.48 5.98 19.38 7.11 18 7.16Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M16.9699 14.44C18.3399 14.67 19.8499 14.43 20.9099 13.72C22.3199 12.78 22.3199 11.24 20.9099 10.3C19.8399 9.59004 18.3099 9.35003 16.9399 9.59003" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M5.96998 7.16C6.02998 7.15 6.09998 7.15 6.15998 7.16C7.53998 7.11 8.63998 5.98 8.63998 4.58C8.63998 3.15 7.48998 2 6.05998 2C4.62998 2 3.47998 3.16 3.47998 4.58C3.48998 5.98 4.58998 7.11 5.96998 7.16Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M6.99994 14.44C5.62994 14.67 4.11994 14.43 3.05994 13.72C1.64994 12.78 1.64994 11.24 3.05994 10.3C4.12994 9.59004 5.65994 9.35003 7.02994 9.59003" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M12 14.63C11.94 14.62 11.87 14.62 11.81 14.63C10.43 14.58 9.32996 13.45 9.32996 12.05C9.32996 10.62 10.48 9.46997 11.91 9.46997C13.34 9.46997 14.49 10.63 14.49 12.05C14.48 13.45 13.38 14.59 12 14.63Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M9.08997 17.78C7.67997 18.72 7.67997 20.26 9.08997 21.2C10.69 22.27 13.31 22.27 14.91 21.2C16.32 20.26 16.32 18.72 14.91 17.78C13.32 16.72 10.69 16.72 9.08997 17.78Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
								</svg>
							</div>
							Attendance
						</div>
					</a>
				</div>
				<div class="flex flex-col gap-1">
					{% if user.is_authenticated %}
					<div role="button" tabindex="0"
						class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
						<div class="grid place-items-center mr-4">
							{% if profilepic != '' %}
							<img src="{{ profilepic }}" class="w-5 h-5 rounded-full" alt="Profile Picture">
							{% else %}
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
								class="bi bi-person-circle" viewBox="0 0 16 16">
								<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
								<path fill-rule="evenodd"
									d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
							</svg>
							{%endif%}
						</div>
						{{ user.username }}
					</div>
					<a href="/signout/">
						<div role="button" tabindex="0"
							class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-indigo-500 hover:bg-opacity-80 hover:text-white outline-none cursor-pointer">
							<div class="grid place-items-center mr-4">
								<svg fill="currentColor" class="w-5 h-5" viewBox="0 0 16 16">
									<path d="M7.5 1v7h1V1z" />
									<path
										d="M3 8.812a5 5 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812" />
								</svg>
							</div>
							Logout
						</div>
					</a>
					{% endif %}
				</div>
			</nav>
		</div>
		<div class="p-8 w-[calc(100vw-18rem)] ml-[18rem]">
			<div class="flex items-center justify-between">
				<div class="w-full flex items-center justify-between">
					<h1 class="text-3xl font-bold">Attendance</h1>
				</div>
				<div>
					<button id="scanQrBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors whitespace-nowrap cursor-pointer">
						Scan QR Code
					</button>
				</div>
			</div>

			<div class="my-5 flex items-start justify-between gap-5 bg-white rounded-xl shadow-[3px_8px_20px_-10px_#00000015] overflow-hidden">
				<table class="attendance-table">
					<thead>
						<tr>
							
							<th>Date</th>
							<th>Time In</th>
							<th>Time Out</th>
							<th>Duration</th>
							<th>Status</th>
						</tr>
					</thead>
					<tbody>
						{% for attendance in attendance_data %}
						<tr>
							
							<td>{{ attendance.date|date:"d/m/Y" }}</td>
							<td>{{ attendance.timeIn|date:"h:i A" }}</td>
							<td>{{ attendance.timeOut|date:"h:i A" }}</td>
							<td>{{ attendance.totalTime }}m</td>
							<td>
								{% if attendance.status == 'Present' %}
								<span class="text-green-600">{{ attendance.status }}</span>
								{% else %}
								<span class="text-red-600">{{ attendance.status }}</span>
								{% endif %}
							</td>
						</tr>
						{% endfor %}
						{% if not attendance_data %}
						<tr>
							<td colspan="5" class="text-center text-gray-500">No attendance records found.</td>
						</tr>
						{% endif %}
					</tbody>
				</table>
			</div>
		</div>

		<div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
			<div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl">
				<div class="flex items-center justify-between mb-4">
					<h3 class="text-xl font-semibold">Scan QR Code</h3>
					<button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
				</div>
				
				<div id="qrReader" class="w-full bg-gray-100 rounded-lg mb-4 flex flex-col items-center justify-center">
					<!-- <video id="qrVideo" class="w-full h-full object-cover rounded-lg" autoplay></video> -->
				</div>
				
				<div id="qrResult" class="hidden">
					<div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
						<p class="text-sm text-green-800">QR Code detected successfully!</p>
						<p class="text-xs text-gray-600 mt-1">Code: <span id="qrCodeValue"></span></p>
					</div>
					<button id="submitAttendance" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
						Submit Attendance
					</button>
				</div>
				
				<div id="qrError" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
					<p class="text-sm text-red-800">Camera access denied or not available.</p>
				</div>
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', function () {
				const links = [...document.querySelectorAll('a')];

				links.forEach(link => {
					if (link.href === window.location.href) {
						link.querySelector('div').classList.add('bg-indigo-500', 'bg-opacity-80', 'text-white');
					}
				});
			});
		</script>
		<script>
		// QR Code scanning functionality
		let html5QrCodeScanner = null;
		let qrCodeData = null;

		document.getElementById('scanQrBtn').addEventListener('click', function() {
			document.getElementById('qrModal').classList.remove('hidden');
			document.getElementById('qrModal').classList.add('flex');
			startQrScanner();
			document.getElementById("qrReader").querySelectorAll("div")[0].style.display = "none";
		});

		document.getElementById('closeModal').addEventListener('click', function() {
			closeQrModal();
		});

		document.getElementById('qrModal').addEventListener('click', function(e) {
			if (e.target === this) {
				closeQrModal();
			}
		});

		document.getElementById('submitAttendance').addEventListener('click', function() {
			if (qrCodeData) {
				// Here you would typically send the QR code data to your server
				console.log('Submitting attendance with QR code:', qrCodeData);
				
				// Show success message
				alert('Attendance submitted successfully!');
				
				// Close modal and reset
				closeQrModal();
				resetQrScanner();
			}
		});

		function startQrScanner() {
			const qrResult = document.getElementById('qrResult');
			const qrError = document.getElementById('qrError');
			
			// Reset states
			qrResult.classList.add('hidden');
			qrError.classList.add('hidden');
			
			function onScanSuccess(decodedText, decodedResult) {
				qrCodeData = decodedText;
				document.getElementById('qrCodeValue').textContent = decodedText;
				document.getElementById('qrResult').classList.remove('hidden');
				
				// Stop scanning after successful detection
				if (html5QrCodeScanner) {
					html5QrCodeScanner.clear();
				}
			}
			
			function onScanFailure(error) {
				// Handle scan failure silently - this fires continuously while scanning
			}
			
			const config = {
				fps: 10,
				qrbox: { width: 250, height: 250 },
				aspectRatio: 1.0
			};
			
			try {
				html5QrCodeScanner = new Html5QrcodeScanner("qrReader", config, false);
				html5QrCodeScanner.render(onScanSuccess, onScanFailure);
			} catch (error) {
				console.error('QR Scanner error:', error);
				qrError.classList.remove('hidden');
			}
		}

		function closeQrModal() {
			document.getElementById('qrModal').classList.add('hidden');
			document.getElementById('qrModal').classList.remove('flex');
			
			// Stop scanner
			if (html5QrCodeScanner) {
				html5QrCodeScanner.clear().then(() => {
					html5QrCodeScanner = null;
				}).catch(error => {
					console.error('Error clearing scanner:', error);
					html5QrCodeScanner = null;
				});
			}
		}

		function resetQrScanner() {
			qrCodeData = null;
			document.getElementById('qrResult').classList.add('hidden');
			document.getElementById('qrError').classList.add('hidden');
		}
		</script>
	</section>
</body>

</html>